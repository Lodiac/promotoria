<!-- ===== M√ìDULO HOJAS DE HORAS CON FULLCALENDAR SPA CORREGIDO ===== -->
<div class="horas-module">
    <!-- HEADER DEL M√ìDULO -->
    <div class="module-header">
        <div class="header-content">
            <div class="header-title">
                <i class="fas fa-calendar-alt header-icon"></i>
                <h1>Hojas de Horas - Sistema Interactivo</h1>
            </div>
            <div class="header-actions">
                <button class="btn-secondary" id="btn-dashboard-horas">
                    <i class="fas fa-chart-pie"></i> Dashboard
                </button>
                <button class="btn-primary" id="btn-nueva-asignacion">
                    <i class="fas fa-plus"></i> Nueva Asignaci√≥n
                </button>
                <button class="btn-primary" id="btn-generar-horarios">
                    <i class="fas fa-sync-alt"></i> Generar Horarios
                </button>
            </div>
        </div>
    </div>
<br>
    <!-- NAVEGACI√ìN POR PESTA√ëAS -->
    <div class="tabs-navigation">
        <div class="tab-item active" data-tab="calendario">
            <i class="fas fa-calendar-alt"></i>
            <span>Calendario</span>
        </div>
        <div class="tab-item" data-tab="asignaciones">
            <i class="fas fa-list"></i>
            <span>Asignaciones</span>
        </div>
        <div class="tab-item" data-tab="dashboard">
            <i class="fas fa-chart-pie"></i>
            <span>Dashboard</span>
        </div>
        <div class="tab-item" data-tab="reportes">
            <i class="fas fa-file-alt"></i>
            <span>Reportes</span>
        </div>
    </div>

    <!-- LOADING DEPENDENCIES -->
    <div class="dependencies-loading" id="dependencies-loading">
        <div class="loading-container">
            <div class="loading-spinner"></div>
            <h3>Cargando FullCalendar...</h3>
            <p>Preparando calendario interactivo...</p>
        </div>
    </div>

    <!-- CONTENIDO PRINCIPAL - CONTAINER PARA TODAS LAS PESTA√ëAS -->
    <div class="main-content" id="main-content-horas" style="display: none;">

        <!-- PESTA√ëA CALENDARIO -->
        <div class="tab-content active" id="tab-calendario">
            <!-- SIDEBAR DE RELACIONES -->
            <div class="relationships-sidebar">
                <!-- PROMOTOR FIJO -->
                <div class="promotor-card promotor-fijo">
                    <div class="promotor-header">
                        <i class="fas fa-user-tie"></i>
                        PROMOTOR FIJO
                    </div>
                    <div class="promotor-info">
                        <div class="promotor-name">Juan Carlos Gonz√°lez</div>
                        <div class="promotor-details">RFC: GOCJ850315ABC<br>Tel: 811-234-5678</div>
                        
                        <div class="tienda-principal">
                            <div class="tienda-principal-label">TIENDA PRINCIPAL</div>
                            <div class="tienda-principal-name">OXXO Centro (#1048)</div>
                            <div style="font-size: 0.8rem; color: #666;">Monterrey, Nuevo Le√≥n</div>
                        </div>
                    </div>
                </div>

                <!-- INDICADOR DE RELACI√ìN -->
                <div class="relationship-indicator">
                    <div class="relationship-title">RELACI√ìN DE APOYO</div>
                    <div class="relationship-visual">
                        <div class="promotor-icon fijo-icon">
                            <i class="fas fa-user-tie"></i>
                        </div>
                        <div class="arrow">
                            <i class="fas fa-handshake"></i>
                        </div>
                        <div class="promotor-icon cubredescansos-icon">
                            <i class="fas fa-user-plus"></i>
                        </div>
                    </div>
                    <div style="font-size: 0.9rem; color: #666;">
                        Mar√≠a cubre los descansos de Juan<br>
                        y apoya en otras tiendas seg√∫n necesidad
                    </div>
                </div>

                <!-- PROMOTOR CUBREDESCANSOS -->
                <div class="promotor-card promotor-cubredescansos">
                    <div class="promotor-header">
                        <i class="fas fa-user-plus"></i>
                        CUBREDESCANSOS
                    </div>
                    <div class="promotor-info">
                        <div class="promotor-name">Mar√≠a Elena Rodr√≠guez</div>
                        <div class="promotor-details">RFC: ROMM900202DEF<br>Tel: 555-123-4567</div>
                        
                        <div class="tienda-principal" style="background: #fff3e0;">
                            <div class="tienda-principal-label" style="color: #f57c00;">ASIGNACI√ìN PRINCIPAL</div>
                            <div class="tienda-principal-name">Apoyo a Juan C. Gonz√°lez</div>
                            <div style="font-size: 0.8rem; color: #666;">+ Rotaci√≥n m√∫ltiples tiendas</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- √ÅREA DEL CALENDARIO -->
            <div class="calendar-area">
                <div class="calendar-header">
                    <div class="calendar-title">
                        <i class="fas fa-calendar-alt"></i>
                        Calendario de Asignaciones
                    </div>
                    <div class="calendar-controls">
                        <button class="view-btn active" data-view="dayGridMonth">Mes</button>
                        <button class="view-btn" data-view="timeGridWeek">Semana</button>
                        <button class="view-btn" data-view="timeGridDay">D√≠a</button>
                        <button class="view-btn" data-view="listWeek">Lista</button>
                    </div>
                </div>

                <div class="calendar-container">
                    <div id="calendar-horas"></div>

                    <!-- LEYENDA -->
                    <div class="legend">
                        <div class="legend-title">Leyenda de Asignaciones</div>
                        <div class="legend-grid">
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(135deg, #1976d2, #1565c0);"></div>
                                <span>Juan - Tienda Principal (OXXO Centro)</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(135deg, #7b1fa2, #6a1b9a);"></div>
                                <span>Juan - Rotaci√≥n en otras tiendas</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(135deg, #f57c00, #ef6c00);"></div>
                                <span>Mar√≠a - Apoyo directo a Juan</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(135deg, #388e3c, #2e7d32);"></div>
                                <span>Mar√≠a - Otras asignaciones</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: #f5f5f5; border: 1px solid #ccc;"></div>
                                <span>D√≠as de descanso</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PESTA√ëA ASIGNACIONES -->
        <div class="tab-content" id="tab-asignaciones">
            <div class="tab-section">
                <div class="section-header">
                    <h2><i class="fas fa-list"></i> Gesti√≥n de Asignaciones</h2>
                    <p>Administra todas las asignaciones de los promotores</p>
                </div>
                
                <div class="filters-bar">
                    <div class="filter-group">
                        <label>Promotor:</label>
                        <select id="filter-promotor" class="form-select">
                            <option value="">Todos</option>
                            <option value="juan">Juan Carlos Gonz√°lez</option>
                            <option value="maria">Mar√≠a Elena Rodr√≠guez</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Tienda:</label>
                        <select id="filter-tienda" class="form-select">
                            <option value="">Todas</option>
                            <option value="oxxo-centro">OXXO Centro</option>
                            <option value="seven-eleven">7-Eleven Plaza</option>
                            <option value="circle-k">Circle K Revoluci√≥n</option>
                            <option value="oxxo-universidad">OXXO Universidad</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Periodo:</label>
                        <select id="filter-periodo" class="form-select">
                            <option value="semana">Esta semana</option>
                            <option value="mes">Este mes</option>
                            <option value="trimestre">Trimestre</option>
                        </select>
                    </div>
                    <button class="btn-primary" onclick="actualizarListaAsignaciones()">
                        <i class="fas fa-sync-alt"></i> Actualizar
                    </button>
                </div>

                <div class="assignments-list" id="assignments-list">
                    <!-- Las asignaciones se cargan din√°micamente aqu√≠ -->
                </div>
            </div>
        </div>

        <!-- PESTA√ëA DASHBOARD -->
        <div class="tab-content" id="tab-dashboard">
            <div class="tab-section">
                <div class="section-header">
                    <h2><i class="fas fa-chart-pie"></i> Dashboard Operativo</h2>
                    <p>M√©tricas y an√°lisis en tiempo real</p>
                </div>

                <div class="dashboard-grid">
                    <div class="metric-card">
                        <div class="metric-icon" style="background: var(--primary-color);">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="metric-content">
                            <div class="metric-value" id="total-assignments">0</div>
                            <div class="metric-label">Asignaciones Total</div>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-icon" style="background: var(--success-color);">
                            <i class="fas fa-percentage"></i>
                        </div>
                        <div class="metric-content">
                            <div class="metric-value" id="coverage-percentage">0%</div>
                            <div class="metric-label">Cobertura Efectiva</div>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-icon" style="background: var(--warning-color);">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="metric-content">
                            <div class="metric-value" id="total-hours">0h</div>
                            <div class="metric-label">Horas Programadas</div>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-icon" style="background: var(--info-color);">
                            <i class="fas fa-store"></i>
                        </div>
                        <div class="metric-content">
                            <div class="metric-value" id="active-stores">0</div>
                            <div class="metric-label">Tiendas Activas</div>
                        </div>
                    </div>
                </div>

                <div class="chart-section">
                    <h3>Distribuci√≥n por Promotor</h3>
                    <div class="chart-placeholder">
                        <div class="chart-visual">
                            <div class="promotor-chart-item">
                                <div class="chart-bar juan-bar" style="width: 65%;">
                                    <span>Juan - 65%</span>
                                </div>
                            </div>
                            <div class="promotor-chart-item">
                                <div class="chart-bar maria-bar" style="width: 35%;">
                                    <span>Mar√≠a - 35%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="summary-section">
                    <h3>Resumen Semanal</h3>
                    <div class="summary-grid">
                        <div class="summary-item">
                            <strong>Lunes a Viernes:</strong> Juan en OXXO Centro (Matutino), Mar√≠a rotaci√≥n vespertina
                        </div>
                        <div class="summary-item">
                            <strong>Fines de Semana:</strong> Mar√≠a cubre descansos de Juan en tienda principal
                        </div>
                        <div class="summary-item">
                            <strong>Productividad:</strong> 91.5% general, superando objetivo del 90%
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PESTA√ëA REPORTES -->
        <div class="tab-content" id="tab-reportes">
            <div class="tab-section">
                <div class="section-header">
                    <h2><i class="fas fa-file-alt"></i> Centro de Reportes</h2>
                    <p>Genera y consulta reportes detallados</p>
                </div>

                <div class="report-controls">
                    <div class="control-group">
                        <label>Tipo de Reporte:</label>
                        <select id="report-type" class="form-select">
                            <option value="general">Reporte General</option>
                            <option value="promotor">Por Promotor</option>
                            <option value="tienda">Por Tienda</option>
                            <option value="horario">An√°lisis de Horarios</option>
                            <option value="cobertura">An√°lisis de Cobertura</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Periodo:</label>
                        <select id="report-period" class="form-select">
                            <option value="semana">√öltima Semana</option>
                            <option value="mes">√öltimo Mes</option>
                            <option value="trimestre">√öltimo Trimestre</option>
                            <option value="custom">Personalizado</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Formato:</label>
                        <select id="report-format" class="form-select">
                            <option value="html">Ver en pantalla</option>
                            <option value="pdf">Exportar PDF</option>
                            <option value="excel">Exportar Excel</option>
                            <option value="csv">Exportar CSV</option>
                        </select>
                    </div>
                    <button class="btn-primary" onclick="generarReporte()">
                        <i class="fas fa-chart-line"></i> Generar Reporte
                    </button>
                </div>

                <div class="report-output" id="report-output">
                    <div class="report-placeholder">
                        <i class="fas fa-file-alt" style="font-size: 3rem; color: #ccc;"></i>
                        <h3>Selecciona los par√°metros y genera tu reporte</h3>
                        <p>Los reportes aparecer√°n aqu√≠ una vez generados</p>
                    </div>
                </div>

                <div class="reports-history">
                    <h3>Reportes Recientes</h3>
                    <div class="history-list">
                        <div class="history-item">
                            <i class="fas fa-file-pdf"></i>
                            <span>Reporte General - Septiembre 2025.pdf</span>
                            <small>Generado hace 2 horas</small>
                        </div>
                        <div class="history-item">
                            <i class="fas fa-file-excel"></i>
                            <span>An√°lisis Promotores - Agosto 2025.xlsx</span>
                            <small>Generado hace 1 d√≠a</small>
                        </div>
                        <div class="history-item">
                            <i class="fas fa-file-csv"></i>
                            <span>Cobertura Tiendas - Q3 2025.csv</span>
                            <small>Generado hace 3 d√≠as</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ERROR STATE -->
    <div class="error-state" id="error-state" style="display: none;">
        <div class="error-container">
            <i class="fas fa-exclamation-triangle"></i>
            <h3>Error cargando FullCalendar</h3>
            <p id="error-message">No se pudieron cargar las dependencias necesarias.</p>
            <button class="btn-primary" onclick="location.reload()">
                <i class="fas fa-redo"></i> Reintentar
            </button>
        </div>
    </div>
</div>

<!-- MODAL DE EVENTO -->
<div id="modal-evento-horas" class="modal-horas">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">Detalles de Asignaci√≥n</h2>
            <button class="close-horas">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label class="form-label">Promotor:</label>
                <select class="form-select" id="event-promotor-horas">
                    <option value="juan">Juan Carlos Gonz√°lez (Fijo)</option>
                    <option value="maria">Mar√≠a Elena Rodr√≠guez (Cubredescansos)</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Tienda:</label>
                <select class="form-select" id="event-tienda-horas">
                    <option value="oxxo-centro">OXXO Centro (#1048)</option>
                    <option value="seven-eleven">7-Eleven Plaza (#1077)</option>
                    <option value="circle-k">Circle K Revoluci√≥n (#1014)</option>
                    <option value="oxxo-universidad">OXXO Universidad (#1038)</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Tipo de Asignaci√≥n:</label>
                <select class="form-select" id="event-tipo-horas">
                    <option value="fijo-principal">Principal (Fijo)</option>
                    <option value="fijo-rotacion">Rotaci√≥n (Fijo)</option>
                    <option value="cubredescansos-apoyo">Apoyo Directo</option>
                    <option value="cubredescansos-otros">Otras Asignaciones</option>
                    <option value="descanso">D√≠a de Descanso</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Horario:</label>
                <select class="form-select" id="event-horario-horas">
                    <option value="6-14">Matutino (6:00 - 14:00)</option>
                    <option value="14-22">Vespertino (14:00 - 22:00)</option>
                    <option value="22-6">Nocturno (22:00 - 6:00)</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Fecha:</label>
                <input type="date" class="form-input" id="event-fecha-horas">
            </div>
            <div class="form-group">
                <label class="form-label">Notas:</label>
                <input type="text" class="form-input" id="event-notas-horas" placeholder="Notas adicionales...">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-cancel-horas" id="btn-cancelar-horas">Cancelar</button>
            <button class="btn-primary" id="btn-guardar-horas">Guardar</button>
            <button class="btn-primary" id="btn-eliminar-horas" style="background: #f44336; display: none;">Eliminar</button>
        </div>
    </div>
</div>

<style>
/* ===== VARIABLES CSS ===== */
:root {
    --primary-color: #667eea;
    --secondary-color: #764ba2;
    --success-color: #4CAF50;
    --warning-color: #ff9800;
    --danger-color: #f44336;
    --info-color: #2196F3;
    --background: #f5f7fa;
    --surface: rgba(255, 255, 255, 0.95);
    --text-primary: #333;
    --text-secondary: #666;
    --border-color: #e0e0e0;
    --shadow: 0 4px 15px rgba(0,0,0,0.08);
    --radius: 12px;
}

/* ===== RESET Y BASE ===== */
.horas-module * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

.horas-module {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    background-color: var(--background);
    color: var(--text-primary);
    min-height: 100vh;
}

/* ===== HEADER STYLES ===== */
.horas-module .module-header {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    padding: 20px 0;
    box-shadow: var(--shadow);
}

.horas-module .header-content {
    max-width: 1800px;
    margin: 0 auto;
    padding: 0 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
}

.horas-module .header-title {
    display: flex;
    align-items: center;
    color: white;
}

.horas-module .header-icon {
    font-size: 2rem;
    margin-right: 15px;
}

.horas-module .header-title h1 {
    font-size: 2rem;
    font-weight: 600;
}

.horas-module .header-actions {
    display: flex;
    gap: 15px;
}

.horas-module .btn-primary, 
.horas-module .btn-secondary {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.9rem;
}

.horas-module .btn-primary {
    background-color: var(--success-color);
    color: white;
}

.horas-module .btn-primary:hover:not(:disabled) {
    background-color: #45a049;
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3);
}

.horas-module .btn-secondary {
    background-color: rgba(255,255,255,0.2);
    color: white;
    backdrop-filter: blur(10px);
}

.horas-module .btn-secondary:hover:not(:disabled) {
    background-color: rgba(255,255,255,0.3);
    transform: translateY(-2px);
}

/* ===== NAVEGACI√ìN POR PESTA√ëAS ===== */
.horas-module .tabs-navigation {
    background: var(--surface);
    border-radius: 0;
    padding: 0;
    margin: 0;
    box-shadow: var(--shadow);
    display: flex;
    max-width: 1800px;
    margin: 0 auto;
}

.horas-module .tab-item {
    flex: 1;
    padding: 16px 20px;
    background: #f8f9fa;
    color: var(--text-secondary);
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    border-bottom: 3px solid transparent;
    font-size: 0.9rem;
}

.horas-module .tab-item:hover {
    background: #e9ecef;
    color: var(--primary-color);
}

.horas-module .tab-item.active {
    background: var(--primary-color);
    color: white;
    border-bottom-color: var(--secondary-color);
    box-shadow: inset 0 2px 8px rgba(0,0,0,0.1);
}

.horas-module .tab-item i {
    font-size: 1.1rem;
}

/* ===== SISTEMA DE PESTA√ëAS CORREGIDO ===== */
.horas-module .main-content {
    max-width: 1800px;
    margin: 0 auto;
    position: relative;
}

/* IMPORTANTE: Cada pesta√±a debe ocupar todo el espacio disponible */
.horas-module .tab-content {
    display: none !important;
    width: 100%;
    min-height: 500px;
    animation: fadeInTab 0.3s ease;
}

.horas-module .tab-content.active {
    display: block !important;
}

@keyframes fadeInTab {
    from { 
        opacity: 0; 
        transform: translateY(10px); 
    }
    to { 
        opacity: 1; 
        transform: translateY(0); 
    }
}

/* ===== PESTA√ëA CALENDARIO - GRID LAYOUT CORREGIDO ===== */
.horas-module #tab-calendario {
    display: none;
    padding: 30px 20px;
    grid-template-columns: 350px 1fr;
    gap: 30px;
    align-items: start;
}

.horas-module #tab-calendario.active {
    display: grid !important;
}

.horas-module .relationships-sidebar {
    display: flex;
    flex-direction: column;
    gap: 20px;
    width: 100%;
}

.horas-module .calendar-area {
    width: 100%;
}

/* ===== OTRAS PESTA√ëAS - PADDING CONSISTENTE ===== */
.horas-module .tab-section {
    padding: 30px 20px;
    width: 100%;
}

.horas-module .section-header {
    text-align: center;
    margin-bottom: 30px;
}

.horas-module .section-header h2 {
    font-size: 1.8rem;
    color: var(--text-primary);
    margin-bottom: 10px;
}

.horas-module .section-header p {
    color: var(--text-secondary);
    font-size: 1.1rem;
}

/* ===== LOADING DEPENDENCIES ===== */
.horas-module .dependencies-loading {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 400px;
    padding: 40px;
}

.horas-module .loading-container {
    text-align: center;
    background: var(--surface);
    backdrop-filter: blur(20px);
    border-radius: var(--radius);
    padding: 3rem;
    box-shadow: var(--shadow);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.horas-module .loading-spinner {
    width: 50px;
    height: 50px;
    border: 4px solid rgba(102, 126, 234, 0.1);
    border-radius: 50%;
    border-top-color: var(--primary-color);
    animation: spin 1s linear infinite;
    margin: 0 auto 20px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.horas-module .loading-container h3 {
    margin-bottom: 10px;
    color: var(--text-primary);
    font-size: 1.3rem;
    font-weight: 600;
}

.horas-module .loading-container p {
    color: var(--text-secondary);
    font-size: 1rem;
}

/* ===== ERROR STATE ===== */
.horas-module .error-state {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 400px;
    padding: 40px;
}

.horas-module .error-container {
    text-align: center;
    background: var(--surface);
    backdrop-filter: blur(20px);
    border-radius: var(--radius);
    padding: 3rem;
    box-shadow: var(--shadow);
    border: 2px solid var(--danger-color);
}

.horas-module .error-container i {
    font-size: 4rem;
    color: var(--danger-color);
    margin-bottom: 1rem;
}

.horas-module .error-container h3 {
    color: var(--danger-color);
    margin-bottom: 1rem;
    font-size: 1.5rem;
}

.horas-module .error-container p {
    color: var(--text-secondary);
    margin-bottom: 2rem;
}

/* ===== PROMOTOR CARDS ===== */
.horas-module .promotor-card {
    background: var(--surface);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.horas-module .promotor-header {
    padding: 20px;
    color: white;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 10px;
}

.horas-module .promotor-fijo .promotor-header {
    background: linear-gradient(135deg, #1976d2, #1565c0);
}

.horas-module .promotor-cubredescansos .promotor-header {
    background: linear-gradient(135deg, #f57c00, #ef6c00);
}

.horas-module .promotor-info {
    padding: 20px;
}

.horas-module .promotor-name {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 10px;
    color: var(--text-primary);
}

.horas-module .promotor-details {
    color: var(--text-secondary);
    margin-bottom: 15px;
    font-size: 0.9rem;
}

.horas-module .tienda-principal {
    background: #e3f2fd;
    padding: 10px;
    border-radius: 6px;
    margin-bottom: 15px;
}

.horas-module .tienda-principal-label {
    font-size: 0.8rem;
    color: #1976d2;
    font-weight: 600;
    margin-bottom: 5px;
    text-transform: uppercase;
}

.horas-module .tienda-principal-name {
    font-weight: 600;
    color: var(--text-primary);
}

/* ===== RELATIONSHIP INDICATOR ===== */
.horas-module .relationship-indicator {
    background: var(--surface);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding: 20px;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.horas-module .relationship-title {
    font-weight: 600;
    margin-bottom: 15px;
    color: var(--text-primary);
    font-size: 0.9rem;
    text-transform: uppercase;
}

.horas-module .relationship-visual {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
    margin-bottom: 15px;
}

.horas-module .promotor-icon {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.5rem;
}

.horas-module .fijo-icon {
    background: linear-gradient(135deg, #1976d2, #1565c0);
}

.horas-module .cubredescansos-icon {
    background: linear-gradient(135deg, #f57c00, #ef6c00);
}

.horas-module .arrow {
    font-size: 2rem;
    color: var(--success-color);
}

/* ===== CALENDAR AREA ===== */
.horas-module .calendar-area {
    background: var(--surface);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.horas-module .calendar-header {
    background: linear-gradient(135deg, #26c6da, #00acc1);
    color: white;
    padding: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
}

.horas-module .calendar-title {
    font-size: 1.3rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 10px;
}

.horas-module .calendar-controls {
    display: flex;
    gap: 10px;
    align-items: center;
}

.horas-module .view-btn {
    background: rgba(255,255,255,0.2);
    border: none;
    color: white;
    padding: 8px 12px;
    border-radius: 6px;
    cursor: pointer;
    backdrop-filter: blur(10px);
    font-size: 0.9rem;
    transition: all 0.3s ease;
}

.horas-module .view-btn.active {
    background: rgba(255,255,255,0.4);
}

.horas-module .view-btn:hover {
    background: rgba(255,255,255,0.3);
}

/* ===== CALENDAR CONTAINER ===== */
.horas-module .calendar-container {
    padding: 20px;
}

.horas-module #calendar-horas {
    height: 700px;
}

/* ===== FILTROS Y CONTROLES ===== */
.horas-module .filters-bar {
    display: flex;
    gap: 20px;
    align-items: end;
    margin-bottom: 30px;
    padding: 20px;
    background: var(--surface);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    flex-wrap: wrap;
}

.horas-module .filter-group {
    display: flex;
    flex-direction: column;
    gap: 5px;
    min-width: 150px;
}

.horas-module .filter-group label {
    font-weight: 600;
    color: var(--text-primary);
    font-size: 0.9rem;
}

/* ===== LISTA DE ASIGNACIONES ===== */
.horas-module .assignments-list {
    display: grid;
    gap: 15px;
}

.horas-module .assignment-card {
    background: var(--surface);
    border-radius: var(--radius);
    padding: 20px;
    box-shadow: var(--shadow);
    border: 1px solid var(--border-color);
    transition: all 0.3s ease;
}

.horas-module .assignment-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.12);
}

/* ===== DASHBOARD ===== */
.horas-module .dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.horas-module .metric-card {
    background: var(--surface);
    border-radius: var(--radius);
    padding: 20px;
    box-shadow: var(--shadow);
    display: flex;
    align-items: center;
    gap: 15px;
    border: 1px solid var(--border-color);
    transition: transform 0.3s ease;
}

.horas-module .metric-card:hover {
    transform: translateY(-3px);
}

.horas-module .metric-icon {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.5rem;
}

.horas-module .metric-content {
    flex: 1;
}

.horas-module .metric-value {
    font-size: 2rem;
    font-weight: 700;
    color: var(--text-primary);
    line-height: 1;
}

.horas-module .metric-label {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-top: 5px;
}

.horas-module .chart-section {
    background: var(--surface);
    border-radius: var(--radius);
    padding: 20px;
    box-shadow: var(--shadow);
    margin-bottom: 20px;
}

.horas-module .chart-placeholder {
    height: 200px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.horas-module .chart-visual {
    width: 100%;
    max-width: 400px;
}

.horas-module .promotor-chart-item {
    margin-bottom: 15px;
}

.horas-module .chart-bar {
    height: 40px;
    border-radius: 20px;
    display: flex;
    align-items: center;
    padding: 0 15px;
    color: white;
    font-weight: 600;
    transition: width 0.8s ease;
}

.horas-module .juan-bar {
    background: linear-gradient(135deg, #1976d2, #1565c0);
}

.horas-module .maria-bar {
    background: linear-gradient(135deg, #f57c00, #ef6c00);
}

.horas-module .summary-section {
    background: var(--surface);
    border-radius: var(--radius);
    padding: 20px;
    box-shadow: var(--shadow);
}

.horas-module .summary-grid {
    display: grid;
    gap: 15px;
    margin-top: 15px;
}

.horas-module .summary-item {
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid var(--primary-color);
}

/* ===== REPORTES ===== */
.horas-module .report-controls {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    align-items: end;
    margin-bottom: 30px;
    padding: 20px;
    background: var(--surface);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
}

.horas-module .control-group {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.horas-module .control-group label {
    font-weight: 600;
    color: var(--text-primary);
    font-size: 0.9rem;
}

.horas-module .report-output {
    background: var(--surface);
    border-radius: var(--radius);
    padding: 40px;
    box-shadow: var(--shadow);
    margin-bottom: 30px;
    min-height: 300px;
}

.horas-module .report-placeholder {
    text-align: center;
    color: var(--text-secondary);
}

.horas-module .report-placeholder h3 {
    margin: 15px 0 10px;
}

.horas-module .reports-history {
    background: var(--surface);
    border-radius: var(--radius);
    padding: 20px;
    box-shadow: var(--shadow);
}

.horas-module .history-list {
    display: grid;
    gap: 10px;
    margin-top: 15px;
}

.horas-module .history-item {
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
    display: flex;
    align-items: center;
    gap: 15px;
    transition: background 0.3s ease;
}

.horas-module .history-item:hover {
    background: #e9ecef;
    cursor: pointer;
}

.horas-module .history-item i {
    font-size: 1.2rem;
    color: var(--primary-color);
}

.horas-module .history-item span {
    flex: 1;
    font-weight: 500;
}

.horas-module .history-item small {
    color: var(--text-secondary);
    font-size: 0.8rem;
}

/* ===== FULLCALENDAR CUSTOMIZATION ===== */
.horas-module .fc-event {
    border: none !important;
    border-radius: 6px !important;
    font-size: 0.8rem !important;
    font-weight: 600 !important;
    padding: 2px 6px !important;
    margin: 1px 0 !important;
}

/* Eventos del promotor fijo - tienda principal */
.horas-module .event-fijo-principal {
    background: linear-gradient(135deg, #1976d2, #1565c0) !important;
    color: white !important;
    border-left: 4px solid #0d47a1 !important;
}

/* Eventos del promotor fijo - rotaci√≥n */
.horas-module .event-fijo-rotacion {
    background: linear-gradient(135deg, #7b1fa2, #6a1b9a) !important;
    color: white !important;
    border-left: 4px solid #4a148c !important;
}

/* Eventos cubredescansos - apoyo */
.horas-module .event-cubredescansos-apoyo {
    background: linear-gradient(135deg, #f57c00, #ef6c00) !important;
    color: white !important;
    border-left: 4px solid #e65100 !important;
}

/* Eventos cubredescansos - otros */
.horas-module .event-cubredescansos-otros {
    background: linear-gradient(135deg, #388e3c, #2e7d32) !important;
    color: white !important;
    border-left: 4px solid #1b5e20 !important;
}

/* D√≠as de descanso */
.horas-module .event-descanso {
    background: #f5f5f5 !important;
    color: #999 !important;
    border-left: 4px solid #ccc !important;
}

/* ===== LEGEND ===== */
.horas-module .legend {
    margin-top: 20px;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
}

.horas-module .legend-title {
    font-weight: 600;
    margin-bottom: 15px;
    color: var(--text-primary);
}

.horas-module .legend-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 10px;
}

.horas-module .legend-item {
    display: flex;
    align-items: center;
    gap: 10px;
}

.horas-module .legend-color {
    width: 20px;
    height: 15px;
    border-radius: 3px;
}

/* ===== MODAL STYLES ===== */
.modal-horas {
    display: none;
    position: fixed;
    z-index: 10000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
    backdrop-filter: blur(10px);
}

.modal-content {
    background-color: white;
    margin: 5% auto;
    padding: 0;
    border-radius: var(--radius);
    width: 90%;
    max-width: 500px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    animation: modalSlideIn 0.3s ease;
}

@keyframes modalSlideIn {
    from {
        transform: translateY(-50px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

.modal-header {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: white;
    padding: 20px;
    border-radius: var(--radius) var(--radius) 0 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-title {
    font-size: 1.3rem;
    font-weight: 600;
}

.close-horas {
    color: white;
    font-size: 2rem;
    font-weight: bold;
    cursor: pointer;
    border: none;
    background: none;
    padding: 5px;
    border-radius: 50%;
    transition: all 0.3s ease;
}

.close-horas:hover {
    background: rgba(255,255,255,0.2);
}

.modal-body {
    padding: 20px;
}

.form-group {
    margin-bottom: 15px;
}

.form-label {
    display: block;
    margin-bottom: 5px;
    font-weight: 600;
    color: var(--text-primary);
}

.form-input, 
.form-select {
    width: 100%;
    padding: 10px;
    border: 2px solid var(--border-color);
    border-radius: 6px;
    font-size: 1rem;
    transition: all 0.3s ease;
    box-sizing: border-box;
}

.form-input:focus, 
.form-select:focus {
    border-color: var(--primary-color);
    outline: none;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.modal-footer {
    padding: 20px;
    text-align: right;
    border-top: 1px solid var(--border-color);
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}

.btn-cancel-horas {
    padding: 10px 20px;
    background: #ccc;
    color: var(--text-primary);
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-cancel-horas:hover {
    background: #bbb;
}

/* ===== RESPONSIVE ===== */
@media (max-width: 1024px) {
    .horas-module #tab-calendario.active {
        grid-template-columns: 1fr;
        padding: 20px 10px;
    }
    
    .horas-module .relationships-sidebar {
        flex-direction: row;
        overflow-x: auto;
        width: 100%;
        gap: 15px;
    }
    
    .horas-module .promotor-card {
        min-width: 280px;
        flex-shrink: 0;
    }

    .horas-module .dashboard-grid {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    }

    .horas-module .filters-bar,
    .horas-module .report-controls {
        grid-template-columns: 1fr;
        gap: 15px;
    }
}

@media (max-width: 768px) {
    .horas-module .header-content {
        flex-direction: column;
        text-align: center;
    }

    .horas-module .header-actions {
        width: 100%;
        justify-content: center;
    }

    .horas-module .tabs-navigation {
        flex-direction: column;
    }

    .horas-module .tab-item {
        padding: 12px 15px;
    }

    .horas-module .calendar-header {
        flex-direction: column;
        text-align: center;
    }

    .horas-module #calendar-horas {
        height: 500px;
    }

    .horas-module .tab-section {
        padding: 20px 10px;
    }

    .horas-module .metric-card {
        flex-direction: column;
        text-align: center;
        gap: 10px;
    }
}

@media (max-width: 480px) {
    .modal-content {
        margin: 2% 5%;
        max-width: calc(100% - 10px);
    }

    .modal-footer {
        flex-direction: column;
    }

    .btn-primary,
    .btn-cancel-horas {
        width: 100%;
        margin-bottom: 10px;
    }

    .horas-module .relationships-sidebar {
        flex-direction: column;
    }

    .horas-module .tab-item span {
        display: none;
    }

    .horas-module .chart-visual {
        font-size: 0.8rem;
    }
}
</style>

<script>
(function() {
    'use strict';
    
    console.log('üöÄ Iniciando m√≥dulo Hojas de Horas con pesta√±as CORREGIDO...');
    
    // ===== VARIABLES GLOBALES =====
    let calendar = null;
    let currentEvent = null;
    let isFullCalendarLoaded = false;
    let loadingPromise = null;
    let cleanupListeners = [];
    let currentTab = 'calendario';
    
    // ===== ELEMENTOS DOM =====
    const elements = {
        dependenciesLoading: document.getElementById('dependencies-loading'),
        mainContentHoras: document.getElementById('main-content-horas'),
        errorState: document.getElementById('error-state'),
        errorMessage: document.getElementById('error-message')
    };
    
    // ===== REGISTRAR CLEANUP EN EL SISTEMA SPA =====
    if (window.registerModuleCleanup) {
        window.registerModuleCleanup(function() {
            console.log('üßπ Limpiando m√≥dulo Hojas de Horas...');
            
            // Destruir FullCalendar
            if (calendar) {
                try {
                    calendar.destroy();
                } catch (error) {
                    console.warn('‚ö†Ô∏è Error destruyendo calendar:', error);
                }
                calendar = null;
            }
            
            // Limpiar event listeners
            cleanupListeners.forEach(cleanup => {
                try { cleanup(); } catch (e) { console.warn('Error limpiando listener:', e); }
            });
            cleanupListeners = [];
            
            // Cerrar modal
            const modal = document.getElementById('modal-evento-horas');
            if (modal) modal.style.display = 'none';
            
            // Reset variables
            currentEvent = null;
            isFullCalendarLoaded = false;
            loadingPromise = null;
            currentTab = 'calendario';
            
            console.log('‚úÖ M√≥dulo Hojas de Horas limpiado');
        });
    }
    
    // ===== HELPER PARA EVENT LISTENERS =====
    function addListener(element, event, handler, options) {
        if (!element) return;
        element.addEventListener(event, handler, options);
        cleanupListeners.push(() => element.removeEventListener(event, handler, options));
    }
    
    // ===== DATOS DE EVENTOS =====
    const eventos = [
        // Juan - Tienda Principal
        { id: 'j1', title: 'Juan - OXXO Centro', start: '2025-09-01T06:00:00', end: '2025-09-01T14:00:00', className: 'event-fijo-principal', extendedProps: { promotor: 'juan', tipo: 'fijo-principal', tienda: 'oxxo-centro' }},
        { id: 'j2', title: 'Juan - OXXO Centro', start: '2025-09-02T06:00:00', end: '2025-09-02T14:00:00', className: 'event-fijo-principal', extendedProps: { promotor: 'juan', tipo: 'fijo-principal', tienda: 'oxxo-centro' }},
        { id: 'j3', title: 'Juan - OXXO Centro', start: '2025-09-03T06:00:00', end: '2025-09-03T14:00:00', className: 'event-fijo-principal', extendedProps: { promotor: 'juan', tipo: 'fijo-principal', tienda: 'oxxo-centro' }},
        { id: 'j4', title: 'Juan - OXXO Centro', start: '2025-09-04T06:00:00', end: '2025-09-04T14:00:00', className: 'event-fijo-principal', extendedProps: { promotor: 'juan', tipo: 'fijo-principal', tienda: 'oxxo-centro' }},
        { id: 'j5', title: 'Juan - OXXO Centro', start: '2025-09-05T06:00:00', end: '2025-09-05T14:00:00', className: 'event-fijo-principal', extendedProps: { promotor: 'juan', tipo: 'fijo-principal', tienda: 'oxxo-centro' }},
        
        // Mar√≠a - Apoyo y otras asignaciones
        { id: 'm1', title: 'Mar√≠a - 7-Eleven', start: '2025-09-01T14:00:00', end: '2025-09-01T22:00:00', className: 'event-cubredescansos-otros', extendedProps: { promotor: 'maria', tipo: 'cubredescansos-otros', tienda: 'seven-eleven' }},
        { id: 'm2', title: 'Mar√≠a - Circle K', start: '2025-09-02T14:00:00', end: '2025-09-02T22:00:00', className: 'event-cubredescansos-otros', extendedProps: { promotor: 'maria', tipo: 'cubredescansos-otros', tienda: 'circle-k' }},
        { id: 'm3', title: 'Mar√≠a - OXXO Univ', start: '2025-09-03T14:00:00', end: '2025-09-03T22:00:00', className: 'event-cubredescansos-otros', extendedProps: { promotor: 'maria', tipo: 'cubredescansos-otros', tienda: 'oxxo-universidad' }},
        { id: 'm4', title: 'Mar√≠a (Apoyo Juan)', start: '2025-09-04T14:00:00', end: '2025-09-04T22:00:00', className: 'event-cubredescansos-apoyo', extendedProps: { promotor: 'maria', tipo: 'cubredescansos-apoyo', tienda: 'oxxo-centro' }},
        { id: 'm5', title: 'Mar√≠a - 7-Eleven', start: '2025-09-05T14:00:00', end: '2025-09-05T22:00:00', className: 'event-cubredescansos-otros', extendedProps: { promotor: 'maria', tipo: 'cubredescansos-otros', tienda: 'seven-eleven' }},
        
        // Fin de semana - Mar√≠a cubre a Juan
        { id: 'm6', title: 'Mar√≠a (Cobertura Juan)', start: '2025-09-07T06:00:00', end: '2025-09-07T14:00:00', className: 'event-cubredescansos-apoyo', extendedProps: { promotor: 'maria', tipo: 'cubredescansos-apoyo', tienda: 'oxxo-centro' }},
        { id: 'm7', title: 'Mar√≠a (Cobertura Juan)', start: '2025-09-08T06:00:00', end: '2025-09-08T14:00:00', className: 'event-cubredescansos-apoyo', extendedProps: { promotor: 'maria', tipo: 'cubredescansos-apoyo', tienda: 'oxxo-centro' }},
        { id: 'jd1', title: 'Juan - Descanso', start: '2025-09-07', className: 'event-descanso', extendedProps: { promotor: 'juan', tipo: 'descanso' }},
        { id: 'jd2', title: 'Juan - Descanso', start: '2025-09-08', className: 'event-descanso', extendedProps: { promotor: 'juan', tipo: 'descanso' }},
        
        // Segunda semana
        { id: 'j9', title: 'Juan - OXXO Centro', start: '2025-09-09T06:00:00', end: '2025-09-09T14:00:00', className: 'event-fijo-principal', extendedProps: { promotor: 'juan', tipo: 'fijo-principal', tienda: 'oxxo-centro' }},
        { id: 'j10', title: 'Juan - OXXO Centro', start: '2025-09-10T06:00:00', end: '2025-09-10T14:00:00', className: 'event-fijo-principal', extendedProps: { promotor: 'juan', tipo: 'fijo-principal', tienda: 'oxxo-centro' }},
        { id: 'j11', title: 'Juan - Circle K', start: '2025-09-11T06:00:00', end: '2025-09-11T14:00:00', className: 'event-fijo-rotacion', extendedProps: { promotor: 'juan', tipo: 'fijo-rotacion', tienda: 'circle-k' }},
        { id: 'j12', title: 'Juan - 7-Eleven', start: '2025-09-12T06:00:00', end: '2025-09-12T14:00:00', className: 'event-fijo-rotacion', extendedProps: { promotor: 'juan', tipo: 'fijo-rotacion', tienda: 'seven-eleven' }},
        
        // Mar√≠a segunda semana
        { id: 'm9', title: 'Mar√≠a - Circle K', start: '2025-09-09T14:00:00', end: '2025-09-09T22:00:00', className: 'event-cubredescansos-otros', extendedProps: { promotor: 'maria', tipo: 'cubredescansos-otros', tienda: 'circle-k' }},
        { id: 'm10', title: 'Mar√≠a - 7-Eleven', start: '2025-09-10T14:00:00', end: '2025-09-10T22:00:00', className: 'event-cubredescansos-otros', extendedProps: { promotor: 'maria', tipo: 'cubredescansos-otros', tienda: 'seven-eleven' }},
        { id: 'm11', title: 'Mar√≠a (Cubre Principal)', start: '2025-09-11T06:00:00', end: '2025-09-11T14:00:00', className: 'event-cubredescansos-apoyo', extendedProps: { promotor: 'maria', tipo: 'cubredescansos-apoyo', tienda: 'oxxo-centro' }},
        { id: 'm12', title: 'Mar√≠a (Cubre Principal)', start: '2025-09-12T06:00:00', end: '2025-09-12T14:00:00', className: 'event-cubredescansos-apoyo', extendedProps: { promotor: 'maria', tipo: 'cubredescansos-apoyo', tienda: 'oxxo-centro' }}
    ];
    
    // ===== FUNCIONES DE CARGA DE DEPENDENCIAS SIMPLIFICADAS =====
    async function loadCSS(url) {
        return new Promise((resolve, reject) => {
            const existingLink = document.querySelector(`link[href="${url}"]`);
            if (existingLink) {
                console.log('‚úÖ CSS ya cargado');
                resolve();
                return;
            }
            
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = url;
            link.onload = () => { 
                console.log('‚úÖ CSS cargado exitosamente'); 
                resolve(); 
            };
            link.onerror = (e) => {
                console.error('‚ùå Error cargando CSS:', e);
                reject(new Error('Error cargando CSS'));
            };
            document.head.appendChild(link);
        });
    }
    
    async function loadJS(url) {
        return new Promise((resolve, reject) => {
            if (window.FullCalendar) {
                console.log('‚úÖ FullCalendar ya disponible');
                resolve();
                return;
            }
            
            const existingScript = document.querySelector(`script[src*="fullcalendar"]`);
            if (existingScript) {
                console.log('‚úÖ Script FullCalendar ya existe');
                setTimeout(() => {
                    if (window.FullCalendar) {
                        resolve();
                    } else {
                        reject(new Error('FullCalendar no disponible'));
                    }
                }, 500);
                return;
            }
            
            const script = document.createElement('script');
            script.src = url;
            script.onload = () => {
                setTimeout(() => {
                    if (window.FullCalendar) {
                        console.log('‚úÖ FullCalendar cargado y disponible');
                        resolve();
                    } else {
                        reject(new Error('FullCalendar no disponible'));
                    }
                }, 300);
            };
            script.onerror = (e) => {
                console.error('‚ùå Error cargando FullCalendar JS:', e);
                reject(new Error('Error cargando FullCalendar JS'));
            };
            document.head.appendChild(script);
        });
    }
    
    async function loadFullCalendarDependencies() {
        if (loadingPromise) return loadingPromise;
        if (isFullCalendarLoaded && window.FullCalendar) return Promise.resolve();
        
        console.log('üîÑ Cargando dependencias de FullCalendar...');
        
        loadingPromise = Promise.all([
            loadCSS('https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.css'),
            loadJS('https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.js')
        ]).then(() => {
            console.log('‚úÖ FullCalendar cargado exitosamente');
            isFullCalendarLoaded = true;
            return true;
        }).catch((error) => {
            console.error('‚ùå Error cargando FullCalendar:', error);
            loadingPromise = null;
            throw error;
        });
        
        return loadingPromise;
    }
    
    // ===== FUNCIONES DE NAVEGACI√ìN POR PESTA√ëAS CORREGIDAS =====
    function switchTab(tabName) {
        console.log(`üîÑ Cambiando a pesta√±a: ${tabName}`);
        
        // Remover clase active de todas las pesta√±as
        document.querySelectorAll('.tab-item').forEach(tab => {
            tab.classList.remove('active');
        });
        
        // Agregar clase active a la pesta√±a seleccionada
        const selectedTab = document.querySelector(`[data-tab="${tabName}"]`);
        if (selectedTab) {
            selectedTab.classList.add('active');
        }
        
        // OCULTAR TODO EL CONTENIDO PRIMERO
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
        });
        
        // MOSTRAR SOLO EL CONTENIDO SELECCIONADO
        const targetTab = document.getElementById(`tab-${tabName}`);
        if (targetTab) {
            targetTab.classList.add('active');
            console.log(`‚úÖ Mostrando contenido de: ${tabName}`);
        } else {
            console.error(`‚ùå No se encontr√≥ el contenido para: ${tabName}`);
        }
        
        currentTab = tabName;
        
        // Ejecutar acciones espec√≠ficas por pesta√±a despu√©s de mostrar el contenido
        setTimeout(() => {
            switch (tabName) {
                case 'calendario':
                    if (calendar) {
                        console.log('üìÖ Redimensionando calendario');
                        calendar.updateSize();
                    }
                    break;
                case 'asignaciones':
                    console.log('üìù Cargando lista de asignaciones');
                    cargarListaAsignaciones();
                    break;
                case 'dashboard':
                    console.log('üìä Actualizando dashboard');
                    actualizarDashboard();
                    break;
                case 'reportes':
                    console.log('üìÑ Pesta√±a reportes activada');
                    break;
                default:
                    console.log(`üìã Pesta√±a ${tabName} activada`);
            }
        }, 100);
    }
    
    // ===== FUNCIONES ESPEC√çFICAS DE PESTA√ëAS =====
    function cargarListaAsignaciones() {
        const assignmentsList = document.getElementById('assignments-list');
        if (!assignmentsList) {
            console.error('‚ùå No se encontr√≥ assignments-list');
            return;
        }
        
        const events = calendar ? calendar.getEvents() : eventos;
        let html = '';
        
        events.forEach(event => {
            const startDate = event.start || new Date(event.start);
            const endDate = event.end || null;
            
            const formatDate = (date) => {
                return date.toLocaleDateString('es-ES', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            };

            const formatTime = (date) => {
                return date.toLocaleTimeString('es-ES', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
            };

            const tiendaNames = {
                'oxxo-centro': 'OXXO Centro (#1048)',
                'seven-eleven': '7-Eleven Plaza (#1077)',
                'circle-k': 'Circle K Revoluci√≥n (#1014)',
                'oxxo-universidad': 'OXXO Universidad (#1038)'
            };

            const promotorNames = {
                'juan': 'Juan Carlos Gonz√°lez',
                'maria': 'Mar√≠a Elena Rodr√≠guez'
            };

            const tipoLabels = {
                'fijo-principal': 'Fijo - Principal',
                'fijo-rotacion': 'Fijo - Rotaci√≥n',
                'cubredescansos-apoyo': 'Cubredescansos - Apoyo',
                'cubredescansos-otros': 'Cubredescansos - Otros',
                'descanso': 'D√≠a de Descanso'
            };

            html += `
                <div class="assignment-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="margin: 0; color: var(--text-primary);">${event.title}</h3>
                        <span style="color: var(--text-secondary); font-size: 0.9rem;">${formatDate(startDate)}</span>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-clock" style="color: var(--primary-color);"></i>
                            <span>${endDate ? formatTime(startDate) + ' - ' + formatTime(endDate) : 'Todo el d√≠a'}</span>
                        </div>
                        
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-user" style="color: var(--primary-color);"></i>
                            <span>${promotorNames[event.extendedProps?.promotor] || 'Sin asignar'}</span>
                        </div>
                        
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-store" style="color: var(--primary-color);"></i>
                            <span>${tiendaNames[event.extendedProps?.tienda] || 'Sin tienda'}</span>
                        </div>
                        
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-tag" style="color: var(--primary-color);"></i>
                            <span>${tipoLabels[event.extendedProps?.tipo] || 'Sin tipo'}</span>
                        </div>
                    </div>
                    
                    ${event.extendedProps?.notas ? `
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 6px; margin-bottom: 15px;">
                            <strong>Notas:</strong> ${event.extendedProps.notas}
                        </div>
                    ` : ''}
                    
                    <div style="display: flex; gap: 8px; justify-content: flex-end;">
                        <button class="btn-primary" style="padding: 6px 12px; font-size: 0.8rem;" onclick="editarEvento('${event.id}')">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button style="padding: 6px 12px; font-size: 0.8rem; background: var(--danger-color); color: white; border: none; border-radius: 6px; cursor: pointer;" onclick="eliminarEvento('${event.id}')">
                            <i class="fas fa-trash"></i> Eliminar
                        </button>
                    </div>
                </div>
            `;
        });
        
        if (html === '') {
            html = '<div style="text-align: center; padding: 40px; color: var(--text-secondary);">No hay asignaciones registradas</div>';
        }
        
        assignmentsList.innerHTML = html;
        console.log(`‚úÖ Lista cargada con ${events.length} asignaciones`);
    }
    
    function actualizarDashboard() {
        const events = calendar ? calendar.getEvents() : eventos;
        
        // Calcular m√©tricas
        const totalAssignments = events.length;
        const totalHours = events.reduce((total, event) => {
            if (event.end && event.start) {
                const duration = (new Date(event.end) - new Date(event.start)) / (1000 * 60 * 60);
                return total + duration;
            }
            return total;
        }, 0);
        
        const activeStores = new Set(events.map(e => e.extendedProps?.tienda).filter(t => t)).size;
        const coverage = Math.min(100, Math.round((totalAssignments / 30) * 100));
        
        // Actualizar elementos del DOM
        const totalElement = document.getElementById('total-assignments');
        const hoursElement = document.getElementById('total-hours');
        const storesElement = document.getElementById('active-stores');
        const coverageElement = document.getElementById('coverage-percentage');
        
        if (totalElement) totalElement.textContent = totalAssignments;
        if (hoursElement) hoursElement.textContent = Math.round(totalHours) + 'h';
        if (storesElement) storesElement.textContent = activeStores;
        if (coverageElement) coverageElement.textContent = coverage + '%';
        
        console.log('üìä Dashboard actualizado:', { totalAssignments, totalHours, activeStores, coverage });
    }
    
    // ===== FUNCIONES GLOBALES PARA BOTONES =====
    window.editarEvento = function(eventId) {
        if (calendar) {
            const event = calendar.getEventById(eventId);
            if (event) openEventModal(event);
        }
    };
    
    window.eliminarEvento = function(eventId) {
        if (confirm('¬øEst√° seguro de eliminar esta asignaci√≥n?')) {
            if (calendar) {
                const event = calendar.getEventById(eventId);
                if (event) {
                    event.remove();
                    cargarListaAsignaciones();
                    actualizarDashboard();
                    console.log('‚úÖ Evento eliminado:', eventId);
                }
            }
        }
    };
    
    window.actualizarListaAsignaciones = function() {
        cargarListaAsignaciones();
        console.log('üîÑ Lista de asignaciones actualizada');
    };
    
    window.generarReporte = function() {
        const reportType = document.getElementById('report-type')?.value || 'general';
        const reportPeriod = document.getElementById('report-period')?.value || 'mes';
        const reportFormat = document.getElementById('report-format')?.value || 'html';
        const reportOutput = document.getElementById('report-output');
        
        if (!reportOutput) return;
        
        const events = calendar ? calendar.getEvents() : eventos;
        
        let reportContent = `
            <div style="text-align: center; margin-bottom: 30px;">
                <h2 style="color: var(--primary-color);">üìä Reporte ${reportType.charAt(0).toUpperCase() + reportType.slice(1)}</h2>
                <p style="color: var(--text-secondary);">Per√≠odo: ${reportPeriod} | Formato: ${reportFormat.toUpperCase()}</p>
                <hr style="margin: 20px 0; border: none; border-top: 2px solid var(--border-color);">
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
                <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; text-align: center;">
                    <h4 style="color: #1976d2; margin-bottom: 10px;">Total Asignaciones</h4>
                    <div style="font-size: 2rem; font-weight: bold;">${events.length}</div>
                </div>
                <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; text-align: center;">
                    <h4 style="color: var(--success-color); margin-bottom: 10px;">Horas Programadas</h4>
                    <div style="font-size: 2rem; font-weight: bold;">312h</div>
                </div>
                <div style="background: #fff3e0; padding: 15px; border-radius: 8px; text-align: center;">
                    <h4 style="color: var(--warning-color); margin-bottom: 10px;">Cobertura</h4>
                    <div style="font-size: 2rem; font-weight: bold;">91.5%</div>
                </div>
                <div style="background: #f3e5f5; padding: 15px; border-radius: 8px; text-align: center;">
                    <h4 style="color: var(--info-color); margin-bottom: 10px;">Tiendas</h4>
                    <div style="font-size: 2rem; font-weight: bold;">4</div>
                </div>
            </div>
            
            <div style="background: white; padding: 20px; border-radius: 8px; border: 1px solid var(--border-color);">
                <h3 style="margin-bottom: 15px; color: var(--text-primary);">Resumen Ejecutivo</h3>
                <ul style="line-height: 1.8; color: var(--text-secondary);">
                    <li>‚úÖ <strong>Cobertura completa</strong> en tienda principal (OXXO Centro)</li>
                    <li>‚úÖ <strong>Mar√≠a Rodr√≠guez</strong> mantiene excelente flexibilidad de horarios</li>
                    <li>‚ö†Ô∏è Se recomienda <strong>optimizar rotaci√≥n</strong> en tiendas secundarias</li>
                    <li>üìà <strong>Productividad general</strong> supera objetivos en 1.5%</li>
                    <li>üéØ <strong>Sin conflictos detectados</strong> en la programaci√≥n actual</li>
                </ul>
            </div>
            
            <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; text-align: center;">
                <small style="color: var(--text-secondary);">
                    Reporte generado el ${new Date().toLocaleDateString('es-ES', { 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    })}
                </small>
            </div>
        `;
        
        reportOutput.innerHTML = reportContent;
        console.log(`üìÑ Reporte generado: ${reportType} - ${reportPeriod}`);
    };
    
    // ===== INICIALIZACI√ìN DEL M√ìDULO =====
    async function initModule() {
        try {
            console.log('üöÄ Iniciando m√≥dulo...');
            
            // Verificar elementos cr√≠ticos
            if (!elements.dependenciesLoading || !elements.mainContentHoras || !elements.errorState) {
                throw new Error('Elementos DOM cr√≠ticos no encontrados');
            }
            
            // Mostrar loading
            elements.dependenciesLoading.style.display = 'flex';
            elements.mainContentHoras.style.display = 'none';
            elements.errorState.style.display = 'none';
            
            // Cargar dependencias
            await loadFullCalendarDependencies();
            
            // Mostrar contenido
            elements.dependenciesLoading.style.display = 'none';
            elements.mainContentHoras.style.display = 'block';
            
            // Inicializar calendar y eventos
            await initializeCalendar();
            initializeEventListeners();
            
            // Cargar contenido inicial del dashboard
            actualizarDashboard();
            
            // Asegurar que se muestre la pesta√±a correcta al inicio
            setTimeout(() => {
                switchTab('calendario');
            }, 100);
            
            console.log('‚úÖ M√≥dulo inicializado correctamente');
            
        } catch (error) {
            console.error('‚ùå Error inicializando m√≥dulo:', error);
            showError(error.message);
        }
    }
    
    function showError(message) {
        elements.dependenciesLoading.style.display = 'none';
        elements.mainContentHoras.style.display = 'none';
        elements.errorState.style.display = 'flex';
        if (elements.errorMessage) elements.errorMessage.textContent = message;
    }
    
    // ===== INICIALIZACI√ìN DE FULLCALENDAR =====
    async function initializeCalendar() {
        if (!window.FullCalendar) throw new Error('FullCalendar no disponible');
        
        const calendarEl = document.getElementById('calendar-horas');
        if (!calendarEl) throw new Error('Elemento calendario no encontrado');
        
        console.log('üìÖ Inicializando FullCalendar...');
        
        calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            locale: 'es',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: ''
            },
            events: eventos,
            editable: true,
            droppable: true,
            selectable: true,
            
            eventClick: function(info) {
                openEventModal(info.event);
            },
            
            select: function(info) {
                openEventModal(null, info.start, info.end);
            },
            
            eventDrop: function(info) {
                console.log('üìÖ Evento movido:', info.event.title);
                actualizarDashboard();
                if (currentTab === 'asignaciones') {
                    cargarListaAsignaciones();
                }
            },
            
            eventResize: function(info) {
                console.log('üìÖ Evento redimensionado:', info.event.title);
                actualizarDashboard();
                if (currentTab === 'asignaciones') {
                    cargarListaAsignaciones();
                }
            },
            
            dayMaxEvents: 3,
            moreLinkClick: 'popover',
            slotMinTime: '06:00:00',
            slotMaxTime: '24:00:00',
            allDaySlot: true,
            firstDay: 1,
            height: 'auto',
            aspectRatio: 1.35
        });
        
        calendar.render();
        console.log('‚úÖ FullCalendar renderizado');
    }
    
    // ===== EVENT LISTENERS =====
    function initializeEventListeners() {
        console.log('üéØ Configurando event listeners...');
        
        // NAVEGACI√ìN POR PESTA√ëAS - CORREGIDO
        document.querySelectorAll('.tab-item').forEach(tab => {
            addListener(tab, 'click', function() {
                const tabName = this.dataset.tab;
                console.log(`üñ±Ô∏è Clic en pesta√±a: ${tabName}`);
                switchTab(tabName);
            });
        });
        
        // Botones de vista del calendario
        document.querySelectorAll('.view-btn').forEach(btn => {
            addListener(btn, 'click', function() {
                document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                if (calendar) calendar.changeView(this.dataset.view);
            });
        });
        
        // Bot√≥n nueva asignaci√≥n
        const btnNueva = document.getElementById('btn-nueva-asignacion');
        if (btnNueva) addListener(btnNueva, 'click', () => openEventModal());
        
        // Generar horarios autom√°ticos
        const btnGenerar = document.getElementById('btn-generar-horarios');
        if (btnGenerar) {
            addListener(btnGenerar, 'click', () => {
                if (confirm('¬øGenerar horarios autom√°ticos para el mes?')) {
                    generateAutomaticSchedule();
                }
            });
        }
        
        // Bot√≥n dashboard en header
        const btnDashboard = document.getElementById('btn-dashboard-horas');
        if (btnDashboard) addListener(btnDashboard, 'click', () => switchTab('dashboard'));
        
        // Modal controls
        const closeBtn = document.querySelector('.close-horas');
        const cancelBtn = document.getElementById('btn-cancelar-horas');
        const saveBtn = document.getElementById('btn-guardar-horas');
        const deleteBtn = document.getElementById('btn-eliminar-horas');
        
        if (closeBtn) addListener(closeBtn, 'click', closeModal);
        if (cancelBtn) addListener(cancelBtn, 'click', closeModal);
        if (saveBtn) addListener(saveBtn, 'click', saveEvent);
        if (deleteBtn) addListener(deleteBtn, 'click', deleteEvent);
        
        // Cerrar modal al hacer clic fuera
        addListener(window, 'click', function(event) {
            const modal = document.getElementById('modal-evento-horas');
            if (event.target === modal) closeModal();
        });
        
        console.log('‚úÖ Event listeners configurados');
    }
    
    // ===== FUNCIONES DE MODAL =====
    function openEventModal(event = null, startDate = null, endDate = null) {
        const modal = document.getElementById('modal-evento-horas');
        if (!modal) return;
        
        currentEvent = event;
        
        // Elementos del formulario
        const titleEl = modal.querySelector('.modal-title');
        const promotorEl = document.getElementById('event-promotor-horas');
        const tiendaEl = document.getElementById('event-tienda-horas');
        const tipoEl = document.getElementById('event-tipo-horas');
        const horarioEl = document.getElementById('event-horario-horas');
        const fechaEl = document.getElementById('event-fecha-horas');
        const notasEl = document.getElementById('event-notas-horas');
        const deleteBtn = document.getElementById('btn-eliminar-horas');
        
        if (event) {
            // Editar evento existente
            if (titleEl) titleEl.textContent = 'Editar Asignaci√≥n';
            if (promotorEl) promotorEl.value = event.extendedProps.promotor || 'juan';
            if (tiendaEl) tiendaEl.value = event.extendedProps.tienda || 'oxxo-centro';
            if (tipoEl) tipoEl.value = event.extendedProps.tipo || 'fijo-principal';
            if (fechaEl && event.start) fechaEl.value = event.start.toISOString().split('T')[0];
            if (notasEl) notasEl.value = event.extendedProps.notas || '';
            
            // Determinar horario
            if (horarioEl && event.start) {
                const hour = event.start.getHours();
                if (hour >= 6 && hour < 14) horarioEl.value = '6-14';
                else if (hour >= 14 && hour < 22) horarioEl.value = '14-22';
                else horarioEl.value = '22-6';
            }
            
            if (deleteBtn) deleteBtn.style.display = 'inline-block';
        } else {
            // Nuevo evento
            if (titleEl) titleEl.textContent = 'Nueva Asignaci√≥n';
            if (promotorEl) promotorEl.value = 'juan';
            if (tiendaEl) tiendaEl.value = 'oxxo-centro';
            if (tipoEl) tipoEl.value = 'fijo-principal';
            if (horarioEl) horarioEl.value = '6-14';
            if (notasEl) notasEl.value = '';
            
            if (fechaEl) {
                if (startDate) {
                    fechaEl.value = startDate.toISOString().split('T')[0];
                } else {
                    fechaEl.value = new Date().toISOString().split('T')[0];
                }
            }
            
            if (deleteBtn) deleteBtn.style.display = 'none';
        }
        
        modal.style.display = 'block';
    }
    
    function closeModal() {
        const modal = document.getElementById('modal-evento-horas');
        if (modal) modal.style.display = 'none';
        currentEvent = null;
    }
    
    function saveEvent() {
        const promotorEl = document.getElementById('event-promotor-horas');
        const tiendaEl = document.getElementById('event-tienda-horas');
        const tipoEl = document.getElementById('event-tipo-horas');
        const horarioEl = document.getElementById('event-horario-horas');
        const fechaEl = document.getElementById('event-fecha-horas');
        const notasEl = document.getElementById('event-notas-horas');
        
        if (!promotorEl || !tiendaEl || !tipoEl || !horarioEl || !fechaEl || !calendar) {
            console.error('‚ùå Elementos del formulario o calendar no disponibles');
            return;
        }
        
        const promotor = promotorEl.value;
        const tienda = tiendaEl.value;
        const tipo = tipoEl.value;
        const horario = horarioEl.value;
        const fecha = fechaEl.value;
        const notas = notasEl ? notasEl.value : '';
        
        // Mapear nombres
        const tiendaNames = {
            'oxxo-centro': 'OXXO Centro',
            'seven-eleven': '7-Eleven Plaza',
            'circle-k': 'Circle K Revoluci√≥n',
            'oxxo-universidad': 'OXXO Universidad'
        };
        
        const promotorNames = { 'juan': 'Juan', 'maria': 'Mar√≠a' };
        
        // Crear t√≠tulo
        let title = '';
        if (tipo === 'descanso') {
            title = `${promotorNames[promotor]} - Descanso`;
        } else if (tipo === 'cubredescansos-apoyo') {
            title = `${promotorNames[promotor]} (Apoyo Juan)`;
        } else {
            title = `${promotorNames[promotor]} - ${tiendaNames[tienda]}`;
        }
        
        // Calcular fechas/horas
        const [startHour, endHour] = horario.split('-').map(Number);
        const startDateTime = new Date(fecha + 'T' + startHour.toString().padStart(2, '0') + ':00:00');
        const endDateTime = new Date(fecha + 'T' + endHour.toString().padStart(2, '0') + ':00:00');
        
        if (endHour <= startHour) {
            endDateTime.setDate(endDateTime.getDate() + 1);
        }
        
        const eventData = {
            title: title,
            start: tipo === 'descanso' ? fecha : startDateTime.toISOString(),
            end: tipo === 'descanso' ? undefined : endDateTime.toISOString(),
            className: `event-${tipo}`,
            extendedProps: { promotor, tipo, tienda, notas }
        };
        
        try {
            if (currentEvent) {
                // Actualizar evento existente
                currentEvent.setProp('title', eventData.title);
                currentEvent.setStart(eventData.start);
                if (eventData.end) currentEvent.setEnd(eventData.end);
                currentEvent.setProp('className', eventData.className);
                Object.keys(eventData.extendedProps).forEach(key => {
                    currentEvent.setExtendedProp(key, eventData.extendedProps[key]);
                });
            } else {
                // Crear nuevo evento
                eventData.id = 'new_' + Date.now();
                calendar.addEvent(eventData);
            }
            
            closeModal();
            actualizarDashboard();
            
            if (currentTab === 'asignaciones') {
                cargarListaAsignaciones();
            }
            
            console.log('‚úÖ Evento guardado');
        } catch (error) {
            console.error('‚ùå Error guardando evento:', error);
            alert('Error guardando el evento. Intenta de nuevo.');
        }
    }
    
    function deleteEvent() {
        if (currentEvent && confirm('¬øEliminar esta asignaci√≥n?')) {
            try {
                currentEvent.remove();
                closeModal();
                actualizarDashboard();
                
                if (currentTab === 'asignaciones') {
                    cargarListaAsignaciones();
                }
                
                console.log('‚úÖ Evento eliminado');
            } catch (error) {
                console.error('‚ùå Error eliminando evento:', error);
                alert('Error eliminando el evento. Intenta de nuevo.');
            }
        }
    }
    
    function generateAutomaticSchedule() {
        if (!calendar) {
            console.error('‚ùå Calendar no disponible');
            return;
        }
        
        const today = new Date();
        const endOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
        let eventsAdded = 0;
        
        for (let d = new Date(today); d <= endOfMonth; d.setDate(d.getDate() + 1)) {
            const dayOfWeek = d.getDay();
            const dateStr = d.toISOString().split('T')[0];
            
            if (dayOfWeek >= 1 && dayOfWeek <= 5) {
                const existingEvents = calendar.getEvents().filter(event => 
                    event.start && event.start.toISOString().split('T')[0] === dateStr
                );
                
                if (existingEvents.length === 0) {
                    // Juan matutino
                    calendar.addEvent({
                        id: 'auto_j_' + dateStr,
                        title: 'Juan - OXXO Centro',
                        start: dateStr + 'T06:00:00',
                        end: dateStr + 'T14:00:00',
                        className: 'event-fijo-principal',
                        extendedProps: { promotor: 'juan', tipo: 'fijo-principal', tienda: 'oxxo-centro' }
                    });
                    
                    // Mar√≠a vespertino
                    const tiendas = ['seven-eleven', 'circle-k', 'oxxo-universidad'];
                    const tienda = tiendas[Math.floor(Math.random() * tiendas.length)];
                    const tiendaNames = {
                        'seven-eleven': '7-Eleven',
                        'circle-k': 'Circle K',
                        'oxxo-universidad': 'OXXO Univ'
                    };
                    
                    calendar.addEvent({
                        id: 'auto_m_' + dateStr,
                        title: 'Mar√≠a - ' + tiendaNames[tienda],
                        start: dateStr + 'T14:00:00',
                        end: dateStr + 'T22:00:00',
                        className: 'event-cubredescansos-otros',
                        extendedProps: { promotor: 'maria', tipo: 'cubredescansos-otros', tienda: tienda }
                    });
                    
                    eventsAdded += 2;
                }
            }
        }
        
        actualizarDashboard();
        if (currentTab === 'asignaciones') {
            cargarListaAsignaciones();
        }
        
        alert(`Se generaron ${eventsAdded} eventos autom√°ticamente`);
        console.log(`‚úÖ ${eventsAdded} eventos generados`);
    }
    
    // ===== INICIAR M√ìDULO =====
    initModule();
    
})();
</script>